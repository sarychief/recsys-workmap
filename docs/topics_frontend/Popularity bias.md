Для решения проблемы Popularity Bias (смещения в сторону популярных элементов) в рекомендательных системах применяются следующие методы:

---

### 1. **Ребалансировка данных**
   - **Ресемплинг**: Увеличение веса редких элементов или уменьшение веса популярных в обучающей выборке.
   - **Стратифицированная выборка**: Гарантирует, что в обучении участвуют как популярные, так и нишевые элементы.

---

### 2. **Модификация функции потерь**
   - **Inverse Propensity Weighting (IPW)**: Элементы взвешиваются обратно пропорционально их популярности:
     $$
     L = \sum_{(u,i)} \frac{1}{p(i)} \cdot (r_{u,i} - \hat{r}_{u,i})^2,
     $$
     где \( p(i) \) — вероятность взаимодействия с элементом \( i \).
   - **Регуляризация популярности**: Штраф за предсказание популярных элементов:
     $$
     L = \sum_{(u,i)} (r_{u,i} - \hat{r}_{u,i})^2 + \lambda \cdot \text{popularity}(i).
     $$

---

### 3. **Алгоритмические подходы**
   - **Дебиасинг в матричной факторизации**:
     - Модель разделяет предсказания на две части: **персонализированную** и **популярность**:
       $$
       \hat{r}_{u,i} = \mu + b_u + b_i + \mathbf{u}_u^T \mathbf{v}_i + \alpha \cdot \text{popularity}(i).
       $$
     - Параметр \( \alpha \) контролирует влияние популярности.
   - **Two-Stage модели**:
     1. Предсказание популярности элемента.
     2. Компенсация популярности в финальных рекомендациях.

---

### 4. **Постобработка рекомендаций**
   - **Ранжирование с учётом разнообразия**:
     - Методы вроде **Maximal Marginal Relevance (MMR)**:
       $$
       \text{MMR} = \arg\max_{i} \left( \lambda \cdot \text{релевантность}(i) - (1-\lambda) \cdot \text{похожесть}(i, \text{уже выбранные}) \right).
       $$
   - **Повышение веса нишевых элементов**: Ручное или автоматическое увеличение ранга редких элементов в выдаче.

---

### 5. **Оценка и метрики**
   - **Метрики разнообразия**:
     - **Catalog Coverage**: Доля уникальных элементов в рекомендациях.
     - **Gini Index**: Измеряет неравномерность распределения рекомендаций.
   - **Персонализированные метрики**:
     - **Personalized Popularity Lift**: Сравнивает популярность рекомендованных элементов с историей пользователя.

---

### 6. **Контентные и гибридные методы**
   - **Контентные признаки**: Использование текста, изображений или метаданных для рекомендации менее популярных, но релевантных элементов.
   - **Гибридные модели**: Комбинация коллаборативной фильтрации с контентными моделями для снижения зависимости от популярности.

---

### Примеры реализации:
- **Spotify**: Использует модифицированный BPR (Bayesian Personalized Ranking) с регуляризацией популярности.
- **Netflix**: Комбинирует матричную факторизацию с контентными фильтрами для баланса между популярным и нишевым контентом.

---

### Итог:
Popularity Bias смягчается через комбинацию методов на этапах **предобработки данных**, **обучения модели** и **постобработки**. Ключевая идея — явно учитывать популярность, но не позволять ей доминировать в рекомендациях.